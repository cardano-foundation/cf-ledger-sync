(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{4159:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/use-cases/WalletQueries/wallet02",function(){return t(9011)}])},9011:function(e,s,t){"use strict";t.r(s),t.d(s,{__toc:function(){return d},default:function(){return u}});var a=t(5893),n=t(2673),i=t(2169),l=t(2069);t(9488);var r=t(2643),o={src:"/cf-ledger-sync//_next/static/media/txid.3333ebed.png",height:269,width:1123,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAIAAADq9gq6AAAANElEQVR42g3HMQ4AIAgDQP//yQ6ayMRgFxpIkO1ukXT3iACwge6WVFUrM0dzM7vnTB4p6QNvBS2WV/N3sAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:2},c=t(2154);let d=[{depth:2,value:"2. List a balance's UTXOs",id:"2-list-a-balances-utxos"},{depth:3,value:"'SELECT'ing the information, ie. retrieving the UTXOS:",id:"selecting-the-information-ie-retrieving-the-utxos"},{depth:3,value:"Table JOINs",id:"table-joins"},{depth:3,value:"Filters",id:"filters"},{depth:3,value:"Summary",id:"summary"}];function h(e){let s=Object.assign({h2:"h2",p:"p",pre:"pre",code:"code",span:"span",details:"details",summary:"summary",img:"img",h3:"h3",ul:"ul",li:"li",a:"a"},(0,r.a)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h2,{id:"2-list-a-balances-utxos",children:"2. List a balance's UTXOs"}),"\n",(0,a.jsx)(s.p,{children:"The goal of this query is to identify all Unspent Transaction Outputs (UTXOs) associated with one specific Cardano address. In simpler terms, it's like checking the individual coins and tokens in the wallet that haven't been spent yet."}),"\n",(0,a.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,a.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,a.jsx)(s.span,{className:"line",children:(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"})}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	tx.hash "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" tx_hash,"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	txo."}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"index"'}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" tx_out_index,"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	d.hash "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" datum_hash,"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	s.hash "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" script_hash"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" tx_out txo"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" tx_in ti "})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ti.tx_out_index "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txo."}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"index"'}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ti.tx_out_id "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txo.tx_id "})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" tx"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" tx.id "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txo.tx_id"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" datum d "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" d.id "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txo.inline_datum_id  "})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" script s "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" s.id "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txo.reference_script_id  "})]}),"\n",(0,a.jsx)(s.span,{className:"line",children:(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"})}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    txo.address "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'addr_test1qr70pedl22tnzswcfm39nqvsfan9jgtym2k0lgrftga8j67jel8q0vyag8770e8pu3rf6he70dtrexrsg6waj09cae0svmt57t'"})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ti.id "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"IS"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NULL"})]})]})}),"\n",(0,a.jsxs)(s.details,{children:[(0,a.jsx)(s.summary,{children:(0,a.jsx)(s.p,{children:"Expected results format"})}),(0,a.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,a.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     tx_hash                                                     | tx_out_index |    "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"value"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       | datum_hash | script_hash"})]}),"\n",(0,a.jsx)(s.span,{className:"line",children:(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-----------------------------------------------------------------+--------------+----------------+------------+------------ "})}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"74042d7fa5340a525d6c3f77f446d45efc6830332672e7acbf4241256f65b42f |     "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        |  "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3228190"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       |            |           "})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"74042d7fa5340a525d6c3f77f446d45efc6830332672e7acbf4241256f65b42f |     "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        |  "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"4605029648942"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" |            |            "})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"aa138cb7581757deff37d320f9d6c7a1632607cb76a4615cbc0c1b517a15fb18 |     "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        |  "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"40000000000"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	 |            |                 "})]}),"\n",(0,a.jsxs)(s.span,{className:"line",children:[(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"rows"}),(0,a.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})})]}),"\n",(0,a.jsx)(c.UW,{type:"info",emoji:"\uD83D\uDCA1",children:(0,a.jsxs)(s.p,{children:["It's important to understand how UTxOs are referenced on Cardano. As shown below, a UTxO consists of the reference to the transaction that created it (TxId), and its index (TxIx) on the host transaction. A UTxO is associated with an asset value, an address which dictates its spending conditions and other metadata. A transaction can take multiple inputs (consuming multiple UTxOs) and produce multiple outputs (new UTxOs to be used by future transactions).\n",(0,a.jsx)(s.img,{alt:"txidindex",placeholder:"blur",src:o})]})}),"\n",(0,a.jsx)(s.p,{children:"\uD83D\uDD0E Let's breakdown how this query works."}),"\n",(0,a.jsxs)(c.Rg,{children:[(0,a.jsx)(s.h3,{id:"selecting-the-information-ie-retrieving-the-utxos",children:"'SELECT'ing the information, ie. retrieving the UTXOS:"}),(0,a.jsx)(s.p,{children:"Specifically, we are looking for:"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"tx.hash"})," The unique id (hash) of the transaction."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:'txo."index"'})," The index (position) of the UTXO within the transaction."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"d.hash"})," The hash of any associated datum (think of this as optional additional data attached to the UTXO)."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"s.hash"})," (Optional) The hash of any associated script (an optional script detailing the conditions for spending the UTXO)."]}),"\n"]}),(0,a.jsx)(s.h3,{id:"table-joins",children:"Table JOINs"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"tx_out txo"})," table with information about transaction outputs."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"tx_in ti"})," table with information about transaction inputs. We join these tables so we can check if a UTXO has been spent, i.e., used as an input."]}),"\n",(0,a.jsxs)(s.li,{children:["This ",(0,a.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#tx",children:"tx"})," table holds general transaction information."]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"datum d"})," & ",(0,a.jsx)(s.code,{children:"script s"})," tables hold optional extra data about the UTXO. We use LEFT JOIN because not all UTXOs will have datum or scripts attached."]}),"\n"]}),(0,a.jsx)(s.h3,{id:"filters",children:"Filters"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Filters results for our specific address\n",(0,a.jsx)(s.code,{children:"txo.address = addr_test1qr70pedl22tnzswcfm39nqvsfan9jgtym2k0lgrftga8j67jel8q0vyag8770e8pu3rf6he70dtrexrsg6waj09cae0svmt57t"})]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"ti.id IS NULL"})," is an important condition as it ensures we only get unspent UTXOs, i.e. UTXOs that haven't been used as inputs yet."]}),"\n"]}),(0,a.jsx)(s.h3,{id:"summary",children:"Summary"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["The query starts by looking at all transaction outputs from the ",(0,a.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#tx_out",children:"tx_out"})," table."]}),"\n",(0,a.jsx)(s.li,{children:"It verifies each output belongs to our specific address."}),"\n",(0,a.jsxs)(s.li,{children:["It looks for matches in the ",(0,a.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#tx_in",children:"tx_in"})," table to see if the output has been used as an input."]}),"\n",(0,a.jsxs)(s.li,{children:["If no match is found, ",(0,a.jsx)(s.code,{children:"ti.id IS NULL"}),", then it's an unspent UTXO."]}),"\n",(0,a.jsx)(s.li,{children:"Finally, it fetches any additional information about the optional datum and script, if they exist, and presents the results."}),"\n"]}),(0,a.jsx)(s.p,{children:"Now that you know your balance, you might want to see where it came from. To do this, we'll create a query to fetch the transaction history associated with this address and display it in a list, including additional details for each transaction."})]})]})}let x={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,r.a)(),e.components);return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"pages/use-cases/WalletQueries/wallet02.mdx",route:"/use-cases/WalletQueries/wallet02",timestamp:1726040384e3,pageMap:[{kind:"MdxPage",name:"about",route:"/about"},{kind:"Folder",name:"applications",route:"/applications",children:[{kind:"Meta",data:{ledger_sync_app:"Ledger Sync",streamer_app:"Ledger Sync Streamer"}},{kind:"MdxPage",name:"ledger_sync_app",route:"/applications/ledger_sync_app"},{kind:"MdxPage",name:"streamer_app",route:"/applications/streamer_app"}]},{kind:"MdxPage",name:"build_run",route:"/build_run"},{kind:"MdxPage",name:"design",route:"/design"},{kind:"MdxPage",name:"docker",route:"/docker"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"schema",route:"/schema"},{kind:"Folder",name:"use-cases",route:"/use-cases",children:[{kind:"Folder",name:"WalletQueries",route:"/use-cases/WalletQueries",children:[{kind:"Meta",data:{wallet01:"Find the ADA balance of a wallet",wallet02:"List a balance's UTXOs",wallet03:"Review wallet transaction history",wallet04:"List all tokens in a wallet",wallet05:"Query collection details",wallet06:"Query Token metadata",wallet07:"Query Active Stake Pools",wallet08:"Query Stake Pool details",wallet09:"Stake pool lifetime blocks",wallet10:"List current dReps",wallet11:"Find Active Governance Proposals",wallet12:"Smart contract transaction data"}},{kind:"MdxPage",name:"wallet01",route:"/use-cases/WalletQueries/wallet01"},{kind:"MdxPage",name:"wallet02",route:"/use-cases/WalletQueries/wallet02"},{kind:"MdxPage",name:"wallet03",route:"/use-cases/WalletQueries/wallet03"},{kind:"MdxPage",name:"wallet04",route:"/use-cases/WalletQueries/wallet04"},{kind:"MdxPage",name:"wallet05",route:"/use-cases/WalletQueries/wallet05"},{kind:"MdxPage",name:"wallet06",route:"/use-cases/WalletQueries/wallet06"},{kind:"MdxPage",name:"wallet07",route:"/use-cases/WalletQueries/wallet07"},{kind:"MdxPage",name:"wallet08",route:"/use-cases/WalletQueries/wallet08"},{kind:"MdxPage",name:"wallet09",route:"/use-cases/WalletQueries/wallet09"},{kind:"MdxPage",name:"wallet10",route:"/use-cases/WalletQueries/wallet10"},{kind:"MdxPage",name:"wallet11",route:"/use-cases/WalletQueries/wallet11"},{kind:"MdxPage",name:"wallet12",route:"/use-cases/WalletQueries/wallet12"}]},{kind:"MdxPage",name:"WalletQueries",route:"/use-cases/WalletQueries"},{kind:"Meta",data:{WalletQueries:"Wallet queries",nftqueries:"NFT marketplace"}},{kind:"Folder",name:"nftqueries",route:"/use-cases/nftqueries",children:[{kind:"Meta",data:{nft1:"View Collections",nft2:"View NFT collection details",nft3:"View all assets",nft4:"Minting an NFT",nft5:"Selling an NFT",nft6:"Buying an NFT"}},{kind:"MdxPage",name:"nft1",route:"/use-cases/nftqueries/nft1"},{kind:"MdxPage",name:"nft2",route:"/use-cases/nftqueries/nft2"},{kind:"MdxPage",name:"nft3",route:"/use-cases/nftqueries/nft3"},{kind:"MdxPage",name:"nft4",route:"/use-cases/nftqueries/nft4"},{kind:"MdxPage",name:"nft5",route:"/use-cases/nftqueries/nft5"},{kind:"MdxPage",name:"nft6",route:"/use-cases/nftqueries/nft6"}]},{kind:"MdxPage",name:"nftqueries",route:"/use-cases/nftqueries"}]},{kind:"MdxPage",name:"use-cases",route:"/use-cases"},{kind:"Meta",data:{about:"About",build_run:"Build Run",design:"Design",docker:"Docker",index:"Index",schema:"Schema","use-cases":"Use Cases"}}],flexsearch:{codeblocks:!0},title:"Wallet02",headings:d},pageNextRoute:"/use-cases/WalletQueries/wallet02",nextraLayout:i.ZP,themeConfig:l.Z};var u=(0,n.j)(x)},2069:function(e,s,t){"use strict";var a=t(5893);t(7294);let n={logo:(0,a.jsx)("span",{children:(0,a.jsx)("b",{children:"Ledger Sync"})}),project:{link:"https://github.com/cardano-foundation/cf-ledger-sync"},chat:{link:"https://discord.gg/jw3yeYJw"},docsRepositoryBase:"https://github.com/cardano-foundation/cf-ledger-sync",footer:{text:"Ledger Sync project"},useNextSeoProps:()=>({titleTemplate:"%s – Ledger Sync"}),head:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("meta",{property:"description",content:"Ledger Sync is a Java-based application designed to provide efficient access to Cardano blockchain data"}),(0,a.jsx)("meta",{property:"og:title",content:"Ledger Sync is a Java-based application designed to provide efficient access to Cardano blockchain data"}),(0,a.jsx)("meta",{property:"og:description",content:"Ledger Sync is a Java-based application designed to provide efficient access to Cardano blockchain data"})]})};s.Z=n},5789:function(){}},function(e){e.O(0,[942,888,774,179],function(){return e(e.s=4159)}),_N_E=e.O()}]);