(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[566],{1110:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/use-cases/WalletQueries/wallet08",function(){return l(9226)}])},9226:function(e,s,l){"use strict";l.r(s),l.d(s,{__toc:function(){return t}});var o=l(5893),r=l(2673),n=l(2169),a=l(2069);l(9488);var i=l(2643);l(2154);let t=[{depth:2,value:"8. Query Stake Pool details",id:"8-query-stake-pool-details"},{depth:3,value:"8.1 Gather various stake pool data",id:"81-gather-various-stake-pool-data"},{depth:3,value:"8.2 Find out who owned the stake pool",id:"82-find-out-who-owned-the-stake-pool"},{depth:3,value:"8.3 List of delegators",id:"83-list-of-delegators"},{depth:4,value:"Summary",id:"summary"}];function c(e){let s=Object.assign({h2:"h2",p:"p",code:"code",pre:"pre",span:"span",details:"details",summary:"summary",h3:"h3",ul:"ul",li:"li",a:"a",h4:"h4"},(0,i.a)(),e.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.h2,{id:"8-query-stake-pool-details",children:"8. Query Stake Pool details"}),"\n",(0,o.jsxs)(s.p,{children:["This query retrieves detailed information about a specific staking pool, including its name, ticker, identifier, hash, fixed cost, margin, declared pledge, total lifetime blocks produced, and associated stake account address. For this qury, we will use pool ID ",(0,o.jsx)(s.code,{children:"pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4"})]}),"\n",(0,o.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,o.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph.id ,"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	po.pool_name "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_name,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	po.ticker_name "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_ticker,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph.view "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_id,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph.hash_raw "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_hash,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	pu.fixed_cost "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fixed_cost,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	pu.margin "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" margin,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	pu.pledge "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" declared_pledge,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ltb.lifetime_blocks "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" lifetime_blocks,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	sa.view "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" stake_account"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	pool_hash ph"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_offline_data po "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"on"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" po.pool_id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"and"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (po.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"null"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"or"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" po.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"max"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(po2.id)"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"					"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_offline_data po2"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"					"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" po2.pool_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id))"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_update pu "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"on"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu.hash_id"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"and"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"max"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(pu2.id)"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"					"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_update pu2"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"					"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu2.hash_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id)"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" stake_address sa "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu.reward_addr_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sa.id"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"LEFT JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" poolId, "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"count"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(bk.id) "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" lifetime_blocks"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_hash ph"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	        "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" slot_leader sl "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sl.pool_hash_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	        "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"block"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" bk "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" bk.slot_leader_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sl.id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	        "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GROUP BY"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id	"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"			) "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ltb"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"on"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ltb.poolId "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  ph."}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"view"'}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4'"})]})]})}),"\n",(0,o.jsxs)(s.details,{children:[(0,o.jsx)(s.summary,{children:(0,o.jsx)(s.p,{children:"Expected results format"})}),(0,o.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,o.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     id   |  pool_name |  pool_ticker |            pool_id                                       |       pool_hash                                               | fixed_cost  |margin | declared_pledge | lifetime_blocks | stake_account "})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"----------+------------+--------------+----------------------------------------------------------+---------------------------------------------------------------+-------------+-------+-----------------+-----------------+------------------------------------------------------------------"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"463"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   |  clrPool   |   CLRPL      | pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4 | 929ff8aa67e4e88c66bd6dab59945681f0d64ed1eed1c1c38d3d7d87      | "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"170"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"000"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"000"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" |  "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  |  "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"000"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        |                 | stake_test1uz48zjhv772tacqt93qp0f4425ly0mc44rrgerqhsca4azctyp6hw "})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"rows"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})})]}),"\n",(0,o.jsx)(s.h3,{id:"81-gather-various-stake-pool-data",children:"8.1 Gather various stake pool data"}),"\n",(0,o.jsx)(s.p,{children:"This query gathers data such as pool metadata, stake addresses, and block minting history from various tables."}),"\n",(0,o.jsx)(s.p,{children:"\uD83D\uDD0E Here's a breakdown of what the query does:"}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.code,{children:"SELECT ..."})," clause specifies the columns to be included in our results:"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"ph.id"}),", the id of the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_hash",children:"pool_hash"})," table"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"po.pool_name AS pool_name"})," is the pool's name, retrieved from the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_offline_data",children:"pool_offline_data"})," table"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"po.ticker_name AS pool_ticker"}),"...the pool's ticker symbol."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"ph.view AS pool_id"}),"...the human-readable pool id."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"ph.hash_raw AS pool_hash"}),"...the pool's hash value."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"pu.fixed_cost"}),"...the pool's fixed cost, from ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"})]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"pu.margin"}),"...the pool's margin, also from ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"})]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"pu.pledge AS declared_pledge"}),"...the pool's declared pledge amount."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"ltb.lifetime_blocks"}),"... the total number of blocks minted by the pool (calculated in the subquery)."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.code,{children:"sa.view AS stake_account"}),"...the stake address associated with the pool's rewards"]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["The ",(0,o.jsx)(s.code,{children:"FROM pool_hash ph"})," clause specifies that we are selecting data from the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_hash",children:"pool_hash"}),"table, aliased as ",(0,o.jsx)(s.code,{children:"ph"}),". This table likely stores core pool identification information."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"LEFT JOIN pool_offline_data po ON ..."})," performs a left ",(0,o.jsx)(s.code,{children:"JOIN"})," with the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_offline_data",children:"pool_offline_data"})," table. It matches rows based on ",(0,o.jsx)(s.code,{children:"pool_id"})," and ensures that if multiple entries exist for the same pool, only the latest one is selected (using a subquery to find the maximum id)."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"LEFT JOIN pool_update pu ON ..."})," is another ",(0,o.jsx)(s.code,{children:"LEFT JOIN"}),", this time with ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"}),". It matches on ",(0,o.jsx)(s.code,{children:"hash_id"})," and again selects the latest update for the pool using a similar subquery approach."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"LEFT JOIN stake_address sa ON ..."})," is another ",(0,o.jsx)(s.code,{children:"LEFT JOIN"})," which connects to the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#stake_address",children:"stake_address"})," table to retrieve the stake address linked to the pool's rewards."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"LEFT JOIN (...) AS ltb ON ..."})," incorporates a subquery aliased as ",(0,o.jsx)(s.code,{children:"ltb"}),". This subquery calculates the total number of blocks minted by the pool by joining ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_hash",children:"pool_hash"}),", ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#slot_leader",children:"slot_leader"})," and ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#block",children:"block"})," tables and counting the relevant blocks. The result is then joined back to the main query based on ",(0,o.jsx)(s.code,{children:"poolId"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"WHERE ph.\"view\" = 'pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4'"})," filters the results to include only the data for the specific pool we are interested in."]}),"\n",(0,o.jsx)(s.h3,{id:"82-find-out-who-owned-the-stake-pool",children:"8.2 Find out who owned the stake pool"}),"\n",(0,o.jsx)(s.p,{children:"If you would like to know then the Stake Pool owner account, you could run the following query:"}),"\n",(0,o.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,o.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	sa."}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"view"'}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" owner_account"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	pool_hash ph"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_update pu "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu.hash_id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"MAX"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(pu2.id) "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_update pu2 "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pu2.hash_id)"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_owner po "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	pu.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" po.pool_update_id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" stake_address sa "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	po.addr_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sa.id"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	ph."}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"view"'}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4'"})]})]})}),"\n",(0,o.jsxs)(s.details,{children:[(0,o.jsx)(s.summary,{children:(0,o.jsx)(s.p,{children:"Expected results format"})}),(0,o.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,o.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     owner_account"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"--------------------------------------------------------------------"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  stake_test1uz48zjhv772tacqt93qp0f4425ly0mc44rrgerqhsca4azctyp6hw"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  stake_test1uz00vukcxsleerg97cpa8fk69pryjsa0f0l57gjl60f78ussjymak"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"rows"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})})]}),"\n",(0,o.jsx)(s.p,{children:"\uD83D\uDD0E Lets dig a little deeper to gain a better understanding."}),"\n",(0,o.jsxs)(s.p,{children:["The opening ",(0,o.jsx)(s.code,{children:'SELECT sa."view" AS owner_account'})," clause specifies what data the query should return. It selects the view column from the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#stake_address",children:"stake_address"})," table (aliased as ",(0,o.jsx)(s.code,{children:"sa"}),") and labels it as ",(0,o.jsx)(s.code,{children:"owner_account"})," in the results."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"FROM pool_hash ph"})," clause means we are inspectig the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_hash",children:"pool_hash"})," table, giving it the alias ",(0,o.jsx)(s.code,{children:"ph"}),". This table  stores core information about stake pools, including their unique hashes."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"JOIN pool_update pu ON ph.id = pu.hash_id"})," performs an INNER JOIN with the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"})," table (aliased as ",(0,o.jsx)(s.code,{children:"pu"}),").\nThe join condition is ",(0,o.jsx)(s.code,{children:"ph.id = pu.hash_id"}),", meaning it connects rows from ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_hash",children:"pool_hash"})," and ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"})," where their ids match. This links pool information with its update history."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"AND pu.id = (SELECT MAX(pu2.id) FROM pool_update pu2 WHERE ph.id = pu2.hash_id)"})," is a subquery within the ",(0,o.jsx)(s.code,{children:"JOIN"})," condition. It ensures that only the latest update for each pool is considered. It finds the maximum id from the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"})," table (using the alias ",(0,o.jsx)(s.code,{children:"pu2"}),") for the given ",(0,o.jsx)(s.code,{children:"ph.id"})," and then uses that maximum id to filter the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_update",children:"pool_update"})," table in the main query."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"JOIN pool_owner po ON pu.id = po.pool_update_id"})," is another ",(0,o.jsx)(s.code,{children:"INNER JOIN"})," with the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#pool_owner",children:"pool_owner"})," table. It connects based on ",(0,o.jsx)(s.code,{children:"pu.id = po.pool_update_id"}),", associating the latest pool update with its owner information."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"JOIN stake_address sa ON po.addr_id = sa.id"})," The final ",(0,o.jsx)(s.code,{children:"INNER JOIN"})," connects to the ",(0,o.jsx)(s.a,{href:"https://github.com/cardano-foundation/cf-ledger-sync/blob/main/docs/pages/schema.md#stake_address",children:"stake_address"})," table. The condition ",(0,o.jsx)(s.code,{children:"po.addr_id = sa.id"})," links the pool owner's information with the actual stake address details."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"WHERE ph.\"view\" = 'pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4'"})," filters the results to include only the data related to the specific pool we provided."]}),"\n",(0,o.jsx)(s.h3,{id:"83-list-of-delegators",children:"8.3 List of delegators"}),"\n",(0,o.jsx)(s.p,{children:"If you are trying to obtain a list of delegators for a specific pool, then you could run the following query:"}),"\n",(0,o.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,o.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	sa.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" stakeAddressId,"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	sa.view "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" delegator_address"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" stake_address sa"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sa.id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"IN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg1.addr_id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" delegation dg1"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"JOIN"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pool_hash ph "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ON"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg1.pool_hash_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ph.view "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4'"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"EXISTS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" TRUE"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" delegation dg2"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg2.addr_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg1.addr_id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg2.tx_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg1.tx_id"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	)"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"NOT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"EXISTS"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"SELECT"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" TRUE"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FROM"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" stake_deregistration sd"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"WHERE"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sd.addr_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg1.addr_id"})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"		"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"AND"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sd.tx_id "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dg1.tx_id"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	)"})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})})]})}),"\n",(0,o.jsxs)(s.details,{children:[(0,o.jsx)(s.summary,{children:(0,o.jsx)(s.p,{children:"Expected results format"})}),(0,o.jsx)(s.pre,{"data-language":"sql","data-theme":"default",children:(0,o.jsxs)(s.code,{"data-language":"sql","data-theme":"default",children:[(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     stakeaddressid   |  delegator_address                                      "})}),"\n",(0,o.jsx)(s.span,{className:"line",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"----------------------+-----------------------------------------------------------"})}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"10"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"497"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"	      | stake_test1uzhl7a0df7v82xlm8yt06h9zjqlkmu636grf8g63h6e0q0sxt5gz4 "})]}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"145"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"345"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          | stake_test1uz48zjhv772tacqt93qp0f4425ly0mc44rrgerqhsca4azctyp6hw"})]}),"\n",(0,o.jsx)(s.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(s.span,{className:"line",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"rows"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})})]}),"\n",(0,o.jsx)(s.p,{children:"\uD83D\uDD0E Looking closer, lets dissect each line:"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"SELECT sa.id AS stakeAddressId, sa.view AS delegator_address"})," selects the ",(0,o.jsx)(s.code,{children:"id"})," column (labelling it as ",(0,o.jsx)(s.code,{children:"stakeAddressId"}),") and the ",(0,o.jsx)(s.code,{children:"view"})," column (labellting it as ",(0,o.jsx)(s.code,{children:"delegator_address"}),") from the stake_address table (alias ",(0,o.jsx)(s.code,{children:"sa"}),"). The ",(0,o.jsx)(s.code,{children:"view"})," column likely represents the human-readable format of the stake address."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"FROM stake_address sa"})," means we are looking in the stake_address table."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"WHERE sa.id IN (...)"})," is where we filter by checking if the ",(0,o.jsx)(s.code,{children:"id"})," from the stake_address table exists within the results of the subquery that follows."]}),"\n",(0,o.jsxs)(s.p,{children:["The subquery starts with ",(0,o.jsx)(s.code,{children:"SELECT dg1.addr_id"})," ...selecting the ",(0,o.jsx)(s.code,{children:"addr_id"})," (stake address id) from the delegation table (alias ",(0,o.jsx)(s.code,{children:"dg1"}),")."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"FROM delegation dg1 JOIN pool_hash ph ON dg1.pool_hash_id = ph.id"})," joins the delegation table with the pool_hash table based on the ",(0,o.jsx)(s.code,{children:"pool_hash_id"})," matching in both tables. This connects delegation records with the associated pool information."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"WHERE ph.view = 'pool1j20l32n8un5gce4adk44n9zks8cdvnk3amgursud847cwnpgeg4'"})," filters the joined results to include only delegations to the specific pool we provided."]}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"AND NOT EXISTS (SELECT TRUE FROM delegation dg2 WHERE dg2.addr_id = dg1.addr_id AND dg2.tx_id > dg1.tx_id)"})," ensures that we only consider the latest delegation for each stake address. It checks if there's any other delegation record ",(0,o.jsx)(s.code,{children:"dg2"})," for the same ",(0,o.jsx)(s.code,{children:"addr_id"})," but with a higher ",(0,o.jsx)(s.code,{children:"tx_id"})," (ie. a later transaction). If such a record exists, it excludes the current delegation ",(0,o.jsx)(s.code,{children:"dg1"})," from the results."]}),"\n",(0,o.jsxs)(s.p,{children:["Similarly, the ",(0,o.jsx)(s.code,{children:"AND NOT EXISTS (SELECT TRUE FROM stake_deregistration sd WHERE sd.addr_id = dg1.addr_id AND sd.tx_id > dg1.tx_id)"})," clause checks if there's a stake deregistration record ",(0,o.jsx)(s.code,{children:"sd"})," for the same ",(0,o.jsx)(s.code,{children:"addr_id"})," with a higher ",(0,o.jsx)(s.code,{children:"tx_id"}),". If so, it means the stake address has been deregistered after the delegation, so it's excluded from the results."]}),"\n",(0,o.jsx)(s.h4,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(s.p,{children:"Our first query, 3.1, inspects several tables to return various data on our specific stake pool. Query 3.2 traverses through several tables to pinpoint the owner's stake address for a particular pool. Finally, 3.3 queries the Ledger Sync database schema to return a list of current delegators for the stake pool address we provide."})]})}let d={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.a)(),e.components);return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(c,{...e})}):c(e)},pageOpts:{filePath:"pages/use-cases/WalletQueries/wallet08.mdx",route:"/use-cases/WalletQueries/wallet08",timestamp:1726129223e3,pageMap:[{kind:"Meta",data:{index:"Overview",design:"Design",docker:"Run with Docker Compose",schema:"Schema",build_run:"Build & Run",applications:{title:"Applications"},"use-cases":{title:"Use Cases"},about:{title:"About",type:"page"}}},{kind:"MdxPage",name:"about",route:"/about"},{kind:"Folder",name:"applications",route:"/applications",children:[{kind:"Meta",data:{ledger_sync_app:"Ledger Sync",streamer_app:"Ledger Sync Streamer"}},{kind:"MdxPage",name:"ledger_sync_app",route:"/applications/ledger_sync_app"},{kind:"MdxPage",name:"streamer_app",route:"/applications/streamer_app"}]},{kind:"MdxPage",name:"build_run",route:"/build_run"},{kind:"MdxPage",name:"design",route:"/design"},{kind:"MdxPage",name:"docker",route:"/docker"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"schema",route:"/schema"},{kind:"Folder",name:"use-cases",route:"/use-cases",children:[{kind:"Folder",name:"WalletQueries",route:"/use-cases/WalletQueries",children:[{kind:"Meta",data:{wallet01:"Find the ADA balance of a wallet",wallet02:"List a balance's UTXOs",wallet03:"Review wallet transaction history",wallet04:"List all tokens in a wallet",wallet05:"Query collection details",wallet06:"Query Token metadata",wallet07:"Query Active Stake Pools",wallet08:"Query Stake Pool details",wallet09:"Stake pool lifetime blocks",wallet10:"List current dReps",wallet11:"Find Active Governance Proposals",wallet12:"Smart contract transaction data"}},{kind:"MdxPage",name:"wallet01",route:"/use-cases/WalletQueries/wallet01"},{kind:"MdxPage",name:"wallet02",route:"/use-cases/WalletQueries/wallet02"},{kind:"MdxPage",name:"wallet03",route:"/use-cases/WalletQueries/wallet03"},{kind:"MdxPage",name:"wallet04",route:"/use-cases/WalletQueries/wallet04"},{kind:"MdxPage",name:"wallet05",route:"/use-cases/WalletQueries/wallet05"},{kind:"MdxPage",name:"wallet06",route:"/use-cases/WalletQueries/wallet06"},{kind:"MdxPage",name:"wallet07",route:"/use-cases/WalletQueries/wallet07"},{kind:"MdxPage",name:"wallet08",route:"/use-cases/WalletQueries/wallet08"},{kind:"MdxPage",name:"wallet09",route:"/use-cases/WalletQueries/wallet09"},{kind:"MdxPage",name:"wallet10",route:"/use-cases/WalletQueries/wallet10"},{kind:"MdxPage",name:"wallet11",route:"/use-cases/WalletQueries/wallet11"},{kind:"MdxPage",name:"wallet12",route:"/use-cases/WalletQueries/wallet12"}]},{kind:"MdxPage",name:"WalletQueries",route:"/use-cases/WalletQueries"},{kind:"Meta",data:{WalletQueries:"Wallet queries",nftqueries:"NFT marketplace"}},{kind:"Folder",name:"nftqueries",route:"/use-cases/nftqueries",children:[{kind:"Meta",data:{nft1:"View Collections",nft2:"View NFT collection details",nft3:"View all assets",nft4:"Minting an NFT",nft5:"Selling an NFT",nft6:"Buying an NFT"}},{kind:"MdxPage",name:"nft1",route:"/use-cases/nftqueries/nft1"},{kind:"MdxPage",name:"nft2",route:"/use-cases/nftqueries/nft2"},{kind:"MdxPage",name:"nft3",route:"/use-cases/nftqueries/nft3"},{kind:"MdxPage",name:"nft4",route:"/use-cases/nftqueries/nft4"},{kind:"MdxPage",name:"nft5",route:"/use-cases/nftqueries/nft5"},{kind:"MdxPage",name:"nft6",route:"/use-cases/nftqueries/nft6"}]},{kind:"MdxPage",name:"nftqueries",route:"/use-cases/nftqueries"}]},{kind:"MdxPage",name:"use-cases",route:"/use-cases"}],flexsearch:{codeblocks:!0},title:"Wallet08",headings:t},pageNextRoute:"/use-cases/WalletQueries/wallet08",nextraLayout:n.ZP,themeConfig:a.Z};s.default=(0,r.j)(d)},2069:function(e,s,l){"use strict";var o=l(5893);l(7294);let r={logo:(0,o.jsx)("span",{children:(0,o.jsx)("b",{children:"Ledger Sync"})}),project:{link:"https://github.com/cardano-foundation/cf-ledger-sync"},chat:{link:"https://discord.gg/jw3yeYJw"},docsRepositoryBase:"https://github.com/cardano-foundation/cf-ledger-sync",footer:{text:"Ledger Sync project"},useNextSeoProps:()=>({titleTemplate:"%s – Ledger Sync"}),head:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("meta",{property:"description",content:"Ledger Sync is a Java-based application designed to provide efficient access to Cardano blockchain data"}),(0,o.jsx)("meta",{property:"og:title",content:"Ledger Sync is a Java-based application designed to provide efficient access to Cardano blockchain data"}),(0,o.jsx)("meta",{property:"og:description",content:"Ledger Sync is a Java-based application designed to provide efficient access to Cardano blockchain data"})]})};s.Z=r},5789:function(){}},function(e){e.O(0,[942,888,774,179],function(){return e(e.s=1110)}),_N_E=e.O()}]);